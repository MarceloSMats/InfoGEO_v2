<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>InfoGEO - An√°lise de Uso do Solo</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.css" />
    <link rel="stylesheet" href="css/style.css">
    <link rel="preload" href="js/utils.js" as="script">
    <link rel="preload" href="js/map.js" as="script">
    <style>
        /* Esconder o valor total no cabe√ßalho quando o painel estiver em modo compacto/minimizado */
        .floating-panel.compact .floating-header #floatingTotalValue {
            display: none;
        }

        /* Pequeno ajuste para a se√ß√£o de quadrante dentro do painel maximizado */
        #floatingQuadranteInfo {
            font-size: 13px;
            color: #e7ecff;
            line-height: 1.5;
        }

        #floatingQuadranteInfo .muted {
            color: #9aa7c7;
        }
    </style>
</head>

<body>
    <header>
        <div class="header-content">
            <div class="logo">
                <img src="images/logo.png" alt="InfoGEO Logo" class="logo-img">
            </div>
            <div class="header-text">
                <h1>InfoGEO - Sistema de An√°lises Georreferenciadas</h1>
                <div class="beta-tag">beta - vers√£o: 0.5.6
                </div>
            </div>
            <!-- ADICIONE ESTA SE√á√ÉO -->
            <div class="quick-actions">
                <button class="btn btn-sm btn-pro" id="btnPro" title="Recursos PRO">‚ö° PRO</button>
                <button class="btn btn-sm" id="btnHistory" title="Hist√≥rico (Ctrl+H)">üìä Hist√≥rico</button>
                <button class="btn btn-sm" id="btnSettings" title="Configura√ß√µes">‚öôÔ∏è</button>
                <button class="btn btn-sm" id="btnInfo" title="Informa√ß√µes e Atribui√ß√µes">‚ÑπÔ∏è</button>
            </div>
        </div>
    </header>

    <main>
        <!-- O restante do conte√∫do permanece igual ao original -->
        <aside>
            <div class="section">
                <h2 class="section-title">Upload de Arquivo</h2>
                <div class="row">
                    <div id="drop">
                        <div class="icon">üìÅ</div>
                        <div><b>Solte aqui</b> ou selecione arquivos geoespaciais</div>
                        <div class="muted" style="margin-top:6px">
                            <b>Formatos aceitos:</b><br>
                            ‚Ä¢ KML, KMZ (Google Earth)<br>
                            ‚Ä¢ GeoJSON (.geojson ou .json)<br>
                            ‚Ä¢ Shapefile (.zip com todos os arquivos)<br>
                            ‚Ä¢ GeoPackage (.gpkg)
                        </div>
                        <div style="margin-top:8px">
                            <input type="file" id="file" accept=".kml,.kmz,.geojson,.json,.shp,.zip,.gpkg" multiple />
                        </div>
                    </div>
                </div>

                <div class="row center-buttons">
                    <button class="btn primary" id="btnAnalyze" disabled>Analisar Uso do Solo</button>
                    <button class="btn info" id="btnAnalyzeDeclividade" disabled>Analisar Declividade</button>
                    <button class="btn info" id="btnAnalyzeAptidao" disabled>Analisar Aptid√£o</button>

                    <button class="btn success" id="btnGeneratePdf" disabled>Gerar Relat√≥rio PDF</button>
                </div>
            </div>

            <!-- Logo redimensionada com mensagens e loading acima -->
            <div class="logo-section" style="gap: 8px;">
                <div id="system-messages" style="margin-bottom: 0; text-align: center;"></div>
                <div class="loading" id="loading" style="margin-bottom: 0;">
                    <div class="spinner"></div>
                    <div>Processando an√°lise...</div>
                </div>
                <img src="images/Logo_InfoGEO_.png" alt="InfoGEO Logo"
                    style="width: 65%; max-width: 200px; min-width: 100px; height: auto; margin-left: 0; margin-bottom: 0;">
            </div>
        </aside>

        <section id="mapWrap">
            <div id="leafletMap"></div>
            <canvas id="map"></canvas>

            <div id="hud">Nenhum pol√≠gono carregado</div>
            <div class="satellite-date" id="satelliteDate" style="display: none;">
                Imagem de sat√©lite: <span id="satelliteDateText">n/a</span>
            </div>

            <!-- Novos controles do mapa unificados em linha -->
            <div class="map-hud-controls">
                <div class="map-hud-left">
                    <!-- Pesquisa de Localiza√ß√£o -->
                    <div class="search-container" id="mapSearchContainer">
                        <input type="text" id="mapSearchInput" placeholder="Coordenadas (ex: 23¬∞ S 46¬∞ W)"
                            title="Busca por Coordenadas GMS ou Decimal">
                        <button id="btnMapSearch" title="Pesquisar local">üîç</button>
                        <div id="searchResults" class="search-results"></div>
                    </div>

                    <!-- Seletor de Pol√≠gono (para m√∫ltiplos arquivos) -->
                    <div id="polygonSelectorContainer" style="display: none;"></div>
                </div>

                <div class="map-hud-right">
                    <!-- Navega√ß√£o e Zoom -->
                    <div class="control-group">
                        <button id="btnFit" title="Ajustar aos limites dos pol√≠gonos">üè†</button>
                        <button class="btn" id="btnZoomIn" title="Zoom in">+</button>
                        <button class="btn" id="btnZoomOut" title="Zoom out">‚àí</button>
                    </div>

                    <!-- Tipo de Mapa -->
                    <div class="control-group">
                        <button class="btn primary" id="btnShowMap" title="Visualiza√ß√£o mapa">Mapa</button>
                        <button class="btn" id="btnShowSatellite" title="Visualiza√ß√£o sat√©lite">Sat√©lite</button>
                        <button class="btn" id="btnShowNone" title="Sem base">Nenhum</button>
                    </div>

                    <!-- Ferramentas de Desenho -->
                    <div class="control-group">
                        <button class="btn primary" id="btnDrawPolygon" title="Desenhar pol√≠gono">‚úèÔ∏è Desenhar</button>
                        <button class="btn" id="btnClear" title="Limpar tudo">üóëÔ∏è Limpar</button>
                    </div>

                    <!-- Opacidade -->
                    <div class="opacity-control" id="opacityControl" style="display: none;">
                        <label for="opacitySlider">Opacidade:</label>
                        <input type="range" id="opacitySlider" min="0" max="1" step="0.1" value="0.7">
                    </div>
                </div>
            </div>

            <!-- Modal de Configura√ß√µes -->
            <div class="modal" id="settingsModal" style="display: none;">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3>‚öôÔ∏è Configura√ß√µes</h3>
                        <button class="btn btn-sm" id="btnCloseSettings">√ó</button>
                    </div>
                    <div class="modal-body">
                        <div class="settings-section">
                            <h4>Esquema de Cores</h4>
                            <div class="theme-selector">
                                <label class="theme-option">
                                    <input type="radio" name="theme" value="light">
                                    <span class="theme-label">
                                        <span class="theme-icon">‚òÄÔ∏è</span>
                                        <span class="theme-name">Claro</span>
                                    </span>
                                </label>
                                <label class="theme-option">
                                    <input type="radio" name="theme" value="dark">
                                    <span class="theme-label">
                                        <span class="theme-icon">üåô</span>
                                        <span class="theme-name">Escuro</span>
                                    </span>
                                </label>
                                <label class="theme-option">
                                    <input type="radio" name="theme" value="auto" checked>
                                    <span class="theme-label">
                                        <span class="theme-icon">üîÑ</span>
                                        <span class="theme-name">Autom√°tico</span>
                                    </span>
                                </label>
                            </div>
                            <p class="theme-description">O modo autom√°tico detecta as prefer√™ncias do sistema</p>
                        </div>


                        <div class="settings-section">
                            <h4>Tipo de Raster</h4>
                            <div class="raster-selector">
                                <label class="raster-option">
                                    <input type="radio" name="rasterType" value="com_mosaico" checked>
                                    <span class="raster-label">
                                        <span class="raster-name">Com Mosaico</span>
                                        <span class="raster-file">LULC_VALORACAO_10m_com_mosaico.tif</span>
                                    </span>
                                </label>
                                <label class="raster-option">
                                    <input type="radio" name="rasterType" value="sem_mosaico">
                                    <span class="raster-label">
                                        <span class="raster-name">Sem Mosaico</span>
                                        <span class="raster-file">LULC_Alpha_Biomas_radius_10.tif</span>
                                    </span>
                                </label>
                            </div>
                            <p class="theme-description">Selecione o arquivo raster para an√°lise</p>
                        </div>

                        <div class="settings-section">
                            <h4>Links R√°pidos</h4>
                            <div class="quick-links">
                                <button class="btn" id="btnHistoryFromSettings" style="width: 100%;">
                                    üìä Abrir Hist√≥rico de An√°lises
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal PRO -->
            <div class="modal" id="proModal" style="display: none;">
                <div class="modal-content" style="max-width: 560px;">
                    <div class="modal-header">
                        <h3>‚ö° PRO</h3>
                        <button class="btn btn-sm" id="btnCloseProModal">√ó</button>
                    </div>
                    <div class="modal-body">
                        <!-- Menu principal PRO -->
                        <div id="proMenu">
                            <button class="pro-menu-item" id="btnBatchAnalysis">
                                <span class="pro-menu-icon">üìä</span>
                                <div class="pro-menu-text">
                                    <strong>An√°lise em lote</strong>
                                    <small>Analise m√∫ltiplos pol√≠gonos e exporte CSV</small>
                                </div>
                                <span class="pro-menu-arrow">‚Üí</span>
                            </button>
                            <button class="pro-menu-item" id="btnValoracaoMenu">
                                <span class="pro-menu-icon">üí∞</span>
                                <div class="pro-menu-text">
                                    <strong>Valora√ß√£o</strong>
                                    <small>Calcule o valor do im√≥vel com base em quadrantes e notas agron√¥micas</small>
                                </div>
                                <span class="pro-menu-arrow">‚Üí</span>
                            </button>
                        </div>

                        <!-- Painel de configura√ß√£o de An√°lise em lote -->
                        <div id="batchPanel" style="display: none;">
                            <button class="btn btn-sm" id="btnBackToProMenu" style="margin-bottom: 12px;">‚Üê
                                Voltar</button>
                            <h4 style="color: var(--acc); margin-bottom: 16px;">üìä An√°lise em lote</h4>

                            <!-- Sele√ß√£o de arquivo -->
                            <div class="batch-section">
                                <label class="batch-label">Arquivo de entrada</label>
                                <div class="batch-file-input">
                                    <input type="file" id="batchFileInput"
                                        accept=".kml,.kmz,.geojson,.json,.zip,.gpkg" />
                                    <div class="batch-file-hint">KML, KMZ, GeoJSON, Shapefile (.zip) ou GeoPackage
                                        (.gpkg)</div>
                                </div>
                            </div>

                            <!-- Sele√ß√£o de an√°lises -->
                            <div class="batch-section">
                                <label class="batch-label">An√°lises a executar</label>
                                <div class="batch-checkboxes">
                                    <label class="batch-checkbox">
                                        <input type="checkbox" id="chkUsoSolo" checked />
                                        <span class="batch-check-label">üåæ Uso do Solo</span>
                                    </label>
                                    <label class="batch-checkbox">
                                        <input type="checkbox" id="chkDeclividade" />
                                        <span class="batch-check-label">üìà Declividade</span>
                                    </label>
                                    <label class="batch-checkbox">
                                        <input type="checkbox" id="chkAptidao" />
                                        <span class="batch-check-label">‚ú® Aptid√£o</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Op√ß√µes de exporta√ß√£o -->
                            <div class="batch-section">
                                <label class="batch-label">Op√ß√µes de exporta√ß√£o</label>
                                <div class="batch-checkboxes">
                                    <label class="batch-checkbox">
                                        <input type="checkbox" id="chkIncludeCentroid" />
                                        <span class="batch-check-label">üìç Incluir Centroide (Lat/Lon)</span>
                                    </label>
                                    <label class="batch-checkbox">
                                        <input type="checkbox" id="chkIncludeWkt" />
                                        <span class="batch-check-label">üó∫Ô∏è Incluir Pol√≠gono (WKT)</span>
                                    </label>
                                </div>
                            </div>

                            <!-- Sele√ß√£o de pasta de destino -->
                            <div class="batch-section">
                                <label class="batch-label">Pasta de destino</label>
                                <div class="batch-folder-select">
                                    <button class="btn btn-sm" id="btnSelectFolder">üìÅ Selecionar pasta</button>
                                    <span id="selectedFolderPath" class="batch-folder-path">Pasta de downloads
                                        padr√£o</span>
                                </div>
                            </div>

                            <!-- Bot√£o Executar -->
                            <div class="batch-section" style="margin-top: 20px;">
                                <button class="btn primary batch-execute-btn" id="btnExecuteBatch" disabled>
                                    üöÄ Executar An√°lise em Lote
                                </button>
                            </div>
                        </div>

                        <!-- Painel de Valora√ß√£o -->
                        <div id="valoracaoPanel" style="display: none;">
                            <button class="btn btn-sm" id="btnBackToProMenuFromVal" style="margin-bottom: 12px;">‚Üê
                                Voltar</button>
                            <h4 style="color: var(--acc); margin-bottom: 16px;">üí∞ Valora√ß√£o de Im√≥vel</h4>

                            <!-- Sele√ß√£o de arquivo -->
                            <div class="batch-section">
                                <label class="batch-label">Arquivo com pol√≠gono</label>
                                <div class="batch-file-input">
                                    <input type="file" id="valoracaoFileInput"
                                        accept=".kml,.kmz,.geojson,.json,.zip,.gpkg" />
                                    <div class="batch-file-hint">KML, KMZ, GeoJSON, Shapefile (.zip) ou GeoPackage
                                        (.gpkg)</div>
                                </div>
                            </div>

                            <!-- Seletor de pol√≠gono (aparece se m√∫ltiplos) -->
                            <div class="batch-section" id="valoracaoPolygonSelectorSection" style="display: none;">
                                <label class="batch-label">Selecione o pol√≠gono</label>
                                <div style="display: flex; gap: 8px; align-items: center;">
                                    <select id="valoracaoPolygonSelect" class="batch-select"
                                        style="flex: 1; padding: 8px; background: var(--bg2, #1a1f3a); color: var(--fg, #e7ecff); border: 1px solid var(--border, #2d3561); border-radius: 6px; font-size: 13px;">
                                    </select>
                                    <button class="btn btn-sm" id="btnSelectOnMap"
                                        style="white-space: nowrap; padding: 8px 12px;">üìç Selecionar no Mapa</button>
                                </div>
                            </div>

                            <!-- Status de processamento -->
                            <div id="valoracaoStatus"
                                style="display: none; margin: 12px 0; padding: 10px; border-radius: 6px; font-size: 13px;">
                            </div>

                            <!-- Bot√µes de a√ß√£o -->
                            <div class="batch-section" style="margin-top: 20px; display: flex; gap: 10px;">
                                <button class="btn primary" id="btnExecuteValoracao" disabled style="flex: 1;">üí∞ Valor
                                    do Im√≥vel</button>
                                <button class="btn success" id="btnValoracaoPdf" disabled style="flex: 1;">üìÑ Gerar
                                    Relat√≥rio PDF</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quadro Flutuante para Resultados -->
            <div class="floating-panel" id="floatingPanel" style="display: none;">
                <div class="floating-header">
                    <h3>Resultados da An√°lise</h3>
                    <div id="floatingTotalValue" style="margin-left:10px; font-weight:700; color:#ffd966;"></div>
                    <div class="floating-actions">
                        <button class="btn btn-sm" id="btnMaximizePanel" title="Maximizar">‚õ∂</button>
                        <button class="btn btn-sm" id="btnPinPanel" title="Fixar painel">üìå</button>
                        <button class="btn btn-sm" id="btnClosePanel" title="Fechar">√ó</button>
                    </div>
                </div>

                <div class="floating-content" id="floatingContent">
                    <!-- Left column: Informa√ß√µes do Im√≥vel -->
                    <div id="floatingLeft" class="floating-column">
                        <div class="floating-section">
                            <h4>Informa√ß√µes do Im√≥vel</h4>
                            <div id="floatingImovelBasicInfo" class="property-basic-info">
                                <div style="margin-bottom: 8px;"><strong>Arquivo:</strong> <span
                                        id="floatingFileName">-</span></div>
                                <div style="margin-bottom: 8px;"><strong>C√≥digo:</strong> <span
                                        id="floatingCodigoImovel">-</span></div>
                                <div style="margin-bottom: 8px;"><strong>Centroide:</strong> <span
                                        id="floatingCentroid">-</span></div>
                                <div style="margin-bottom: 8px;"><strong>Munic√≠pio:</strong> <span
                                        id="floatingMunicipio">-</span></div>
                                <div style="margin-bottom: 8px;"><strong>UF:</strong> <span id="floatingUF">-</span>
                                </div>
                                <div style="margin-bottom: 8px;"><strong>√Årea Total:</strong> <span
                                        id="floatingAreaTotal">-</span></div>
                                <div><strong>Classes:</strong> <span id="floatingNumClasses">-</span></div>
                            </div>
                        </div>
                        <div class="floating-section">
                            <h4>Quadrante</h4>
                            <div id="floatingQuadranteInfo">-</div>
                        </div>
                        <div class="floating-section">
                            <h4>Resumo da An√°lise</h4>
                            <div id="floatingSummaryContainer">-</div>
                        </div>
                    </div>

                    <!-- Center column: Tabela de Classes -->
                    <div id="floatingCenter" class="floating-column">
                        <div class="floating-section" style="height: 100%;">
                            <h4>Tabela de Classes</h4>
                            <div id="floatingClassesTableContainer"
                                style="max-height: calc(100% - 40px); overflow-y: auto;"></div>
                        </div>
                    </div>

                    <!-- Right column: Gr√°ficos de Distribui√ß√£o -->
                    <div id="floatingRight" class="floating-column">
                        <!-- Abas de navega√ß√£o (modo normal) -->
                        <div class="chart-tabs" id="chartTabs">
                            <button class="chart-tab active" data-chart="soloUso">
                                <span class="tab-icon">üåæ</span>
                                <span class="tab-label">Uso do Solo</span>
                            </button>
                            <button class="chart-tab" data-chart="declividade" id="tabDeclividade"
                                style="display: none;">
                                <span class="tab-icon">üìà</span>
                                <span class="tab-label">Declividade</span>
                            </button>
                            <button class="chart-tab" data-chart="aptidao" id="tabAptidao" style="display: none;">
                                <span class="tab-icon">‚ú®</span>
                                <span class="tab-label">Aptid√£o</span>
                            </button>
                        </div>
                        <!-- Pain√©is de gr√°fico (modo normal, alternados pelas abas) -->
                        <div class="floating-section chart-panel active" id="chartPanelSoloUso">
                            <h4>Distribui√ß√£o de √Åreas - Uso do Solo</h4>
                            <div class="chart-container">
                                <canvas id="floatingAreaChart"></canvas>
                            </div>
                        </div>
                        <div class="floating-section chart-panel" id="chartPanelDeclividade" style="display: none;">
                            <h4>Distribui√ß√£o de √Åreas - Declividade</h4>
                            <div class="chart-container">
                                <canvas id="floatingAreaChartDeclividade"></canvas>
                            </div>
                        </div>
                        <div class="floating-section chart-panel" id="chartPanelAptidao" style="display: none;">
                            <h4>Distribui√ß√£o de √Åreas - Aptid√£o Agron√¥mica</h4>
                            <div class="chart-container">
                                <canvas id="floatingAreaChartAptidao"></canvas>
                            </div>
                        </div>
                        <!-- Gr√°ficos em modo maximizado foram removidos conforme melhoria. -->
                        <!-- (antes havia o container #maximizedChartsContainer com canvases de pizza) -->
                    </div>
                </div>
            </div>
            <div class="floating-panel history-panel" id="historyPanel" style="display: none; width: 400px;">
                <div class="floating-header">
                    <h3>Hist√≥rico de An√°lises</h3>
                    <button class="btn btn-sm" id="btnCloseHistory">√ó</button>
                </div>
                <div class="floating-content">
                    <div id="historyList"></div>
                </div>
            </div>
            <div class="floating-panel info-panel" id="infoPanel"
                style="display: none; width: 600px; max-height: 80vh;">
                <div class="floating-header">
                    <h3>‚ÑπÔ∏è Informa√ß√µes e Atribui√ß√µes</h3>
                    <button class="btn btn-sm" id="btnCloseInfo">√ó</button>
                </div>
                <div class="floating-content" style="overflow-y: auto; max-height: calc(80vh - 60px);">
                    <div class="info-section">
                        <h4>üå≥ MapBiomas</h4>
                        <p>Os dados do MapBiomas s√£o p√∫blicos, abertos e gratuitos sob licen√ßa Creative Commons CC-BY
                        </p>
                        <blockquote>"MapBiomas ‚Äì Cole√ß√£o 2 beta da s√©rie anual de Mapas de Cobertura e Uso da Terra do
                            Brasil, acessado em setembro/2025 atrav√©s do endere√ßo:
                            https://storage.googleapis.com/mapbiomas-public/initiatives/brasil/lulc_10m/
                            collection_2/integration/mapbiomas_10m_collection2_integration_v1-classification_2023.tif"
                        </blockquote>
                    </div>

                    <div class="info-section">
                        <h4>üì° Embedding</h4>
                        <p>This dataset is licensed under <strong>CC-BY 4.0</strong> and requires the following
                            attribution text:</p>
                        <blockquote>"The AlphaEarth Foundations Satellite Embedding dataset is produced by Google and
                            Google DeepMind."</blockquote>
                    </div>

                    <div class="info-section">
                        <h4>üåç Dynamic World</h4>
                        <p>This dataset is licensed under <strong>CC-BY 4.0</strong> and requires the following
                            attribution:</p>
                        <blockquote>"This dataset is produced for the Dynamic World Project by Google in partnership
                            with National Geographic Society and the World Resources Institute."</blockquote>
                    </div>

                    <div class="info-section">
                        <h4>üõ∞Ô∏è ESA WorldCover v200</h4>
                        <p>The European Space Agency (ESA) WorldCover 10 m 2021 product provides a global land cover map
                            for 2021 at 10 m resolution based on Sentinel-1 and Sentinel-2 data.</p>
                        <p>The WorldCover product comes with 11 land cover classes and has been generated in the
                            framework of the ESA WorldCover project, part of the 5th Earth Observation Envelope
                            Programme (EOEP-5) of the European Space Agency.</p>
                        <p><strong>License:</strong> CC-BY-4.0</p>
                    </div>

                    <div class="info-section"
                        style="border-top: 2px solid #dee2e6; margin-top: 20px; padding-top: 20px;">
                        <h4>üìã Sobre o InfoGEO</h4>
                        <p><strong>Vers√£o:</strong> beta 0.5.5</p>
                        <p><strong>Licen√ßa:</strong> MIT License</p>
                        <p>Sistema desenvolvido para an√°lise geoespacial de uso do solo com integra√ß√£o de m√∫ltiplas
                            fontes de dados.</p>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet.draw/1.0.4/leaflet.draw.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/valoracao.js"></script>
    <script src="js/map.js"></script>
    <script src="js/pdf-generator.js"></script>
    <script src="js/declividade-module.js"></script>
    <script src="js/aptidao-module.js"></script>
    <script src="js/search.js"></script>
    <script src="js/floating-panel.js"></script>
    <script src="js/app.js"></script>
</body>

</html>